apiVersion: constraints.gatekeeper.sh/v1beta1
kind: K8sCapabilitiesRestrictions
metadata:
  name: block-privileged-containers
  annotations:
    description: Block privileged containers and restrict Linux capabilities
spec:
  enforcementAction: deny
  match:
    kinds:
    - apiGroups: [""]
      kinds: ["Pod"]
    excludedNamespaces:
    - kube-system
    - kube-public
    namespaceSelector:
      matchExpressions:
      - key: policy-exempt
        operator: DoesNotExist
  parameters:
    allowedCapabilities:
    - NET_BIND_SERVICE
    - CHOWN
    - DAC_OVERRIDE
    - SETGID
    - SETUID
    requiredDropCapabilities:
    - ALL
    allowPrivileged: false
    blockPrivilegeEscalation: true
    blockHostNamespace: true
